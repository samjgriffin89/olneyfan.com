<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Sam J Griffin | Concatenate column values into a single string text row in SQL</title>
    <meta name="description" content="I am Sam Griffin, a full stack developer currently working at Cardfree,building out RESTful services that supports our mobile apps and customer portal.  For the most part I am working in .NET using Web API, but am becoming more immersed in RoR and grails.
" >
    <meta name="google-site-verification" content="cT3CHL7PrHfUex3GIuLkyjnk-deuZyedUYGqJGOKGEc" />

    <link rel="stylesheet" href="/css/main.css">
    <link rel="alternate" type="application/rss+xml" title="Your awesome title" href="/feed.xml">
  </head>
  <body>
    <div id="wrapper" class="wrapper">
      
      <header class="header">
  <hgroup>
  <h1>
  <a href="/">Sam J Griffin</a>
  </h1>
  <h2>
  <a href="/">Full Stack Developer</a>
  </h2>
  </hgroup>
  <nav id="primaryNav" class="navigation">
    <ul>
      <li>
        <a href="/travel">Travel</a>
      </li>
      <li>
        <a href="/dev-posts">Tech & Coding</a>
      </li>
      <li>
        <a href="https://github.com/samjgriffin89">Projects</a>
      </li>
      <li>
        <a href="https://gist.github.com/samjgriffin89">Code Snippets</a>
      </li>
    </ul>
  </nav>
</header>

      <section class="main-content">
      	<section class="post-wrapper">
	<article class="post">
		<hgroup>
			<div class="post-title">
				<h3>Concatenate column values into a single string text row in SQL</h3>
				
			</div>
			<h5>June  1, 2015</h5>
		</hgroup>
		<p>
		<p>Recently I was working on a SQL script that would pull values for a one-to-many relationship when joining two tables. Rather than having the many row values map to the identifier multiple times, it needed to be formated so there was a single row identifier with a pipe delimited list of the values. So we start with this with:</p>

<table>
  <tbody>
    <tr>
      <td>Identifier</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>Values</td>
    </tr>
    <tr>
      <td>1</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>Value1</td>
    </tr>
    <tr>
      <td>1</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>Value2</td>
    </tr>
    <tr>
      <td>1</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>Value3</td>
    </tr>
    <tr>
      <td>2</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>Value4</td>
    </tr>
    <tr>
      <td>2</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>Value5</td>
    </tr>
  </tbody>
</table>

<p>And we will end up with:</p>

<table>
  <thead>
    <tr>
      <th>Identifier</th>
      <th> </th>
      <th> </th>
      <th> </th>
      <th> </th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>Value1, Value2, Value3</td>
    </tr>
    <tr>
      <td>2</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>Value4, Value5</td>
    </tr>
  </tbody>
</table>

<p>In order to do that, we are going to select the value we want with the delimiter and use SQL’s XML PATH method to combine the rows together from the two tables</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">Identifier</span><span class="p">,</span>
		<span class="k">substring</span><span class="p">(</span>
			<span class="p">(</span>
				<span class="k">SELECT</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">YT1</span><span class="p">.</span><span class="n">Value</span> <span class="k">AS</span> <span class="p">[</span><span class="n">text</span><span class="p">()]</span>
				<span class="k">FROM</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">YourTable2</span><span class="p">]</span> <span class="n">YT2</span>
				<span class="k">WHERE</span> <span class="n">YT1</span><span class="p">.</span><span class="n">Identifier</span> <span class="o">=</span> <span class="n">YT2</span><span class="p">.</span><span class="n">Identifier</span>
				<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">YT1</span><span class="p">.</span><span class="n">Identifier</span>
				<span class="k">FOR</span> <span class="n">XML</span> <span class="n">PATH</span><span class="p">(</span><span class="s1">''</span><span class="p">),</span> <span class="k">TYPE</span>
			<span class="p">).</span><span class="n">value</span><span class="p">(</span><span class="s1">'.[1]'</span><span class="p">,</span> <span class="s1">'VARCHAR(MAX)'</span><span class="p">),</span> 
		<span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="k">Values</span>
		<span class="k">FROM</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">YourTable1</span><span class="p">]</span> <span class="n">YT1</span></code></pre></figure>

<p>It is important to note the <strong>.value(‘.[1]’, ‘VARCHAR(MAX)’)</strong> because that is what will perform the XML encoding and allow for special characters such as &amp;, &lt;, and &gt;.</p>

		</p>	
		<p>
			<strong>Tags:</strong>
			SQL
		</p>
		<a href="/posts">Back to Posts</a>
	</article>
	<div class="sidebar">
	<!-- <h4>Search</h4>
	<div class="posts-search">
		<input type="text" placeholder="Search Posts" />
		<button class="btn primary-btn">Submit</button>
		
		<a class="clear-results" href="/posts">Clear Results</a>
	</div> -->
	<h4>About the Author</h4>
	<div class="about--side">
		<p>I am a senior .NET engineer currently working at <a href="http://www.cardfree.com">CARDFREE</a> building out RESTful services to supports our mobile and web apps. My focus currently is around scalability, security, and ensuring our solutions are maintainable.</p>

<p>Originally from Boston, but have been living in Denver for several years now. In my spare time I try to keep pace with my energentic golden, hike and ski, and occassionally post something interesting.</p>
	</div>
</div>
</section>
      </section>
    </div>

    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24433484-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>