<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Sam J Griffin | Adding Sitecore.Context to Custom Controllers</title>
    <meta name="description" content="I am Sam Griffin, a full stack developer currently working at Cardfree,building out RESTful services that supports our mobile apps and customer portal.  For the most part I am working in .NET using Web API, but am becoming more immersed in RoR and grails.
" >
    <meta name="google-site-verification" content="cT3CHL7PrHfUex3GIuLkyjnk-deuZyedUYGqJGOKGEc" />

    <link rel="stylesheet" href="/css/main.css">
    <link rel="alternate" type="application/rss+xml" title="Your awesome title" href="/feed.xml">
  </head>
  <body>
    <div id="wrapper" class="wrapper">
      
      <header class="header">
  <hgroup>
  <h1>
  <a href="/">Sam J Griffin</a>
  </h1>
  <h2>
  <a href="/">Full Stack Developer</a>
  </h2>
  </hgroup>
  <nav id="primaryNav" class="navigation">
    <ul>
      <li>
        <a href="/travel">Travel</a>
      </li>
      <li>
        <a href="/dev-posts">Tech & Coding</a>
      </li>
      <li>
        <a href="https://github.com/samjgriffin89">Projects</a>
      </li>
      <li>
        <a href="https://gist.github.com/samjgriffin89">Code Snippets</a>
      </li>
    </ul>
  </nav>
</header>

      <section class="main-content">
      	<section class="post-wrapper">
	<article class="post">
		<hgroup>
			<div class="post-title">
				<h3>Adding Sitecore.Context to Custom Controllers</h3>
				
			</div>
			<h5>January  8, 2014</h5>
		</hgroup>
		<p>
		<p>If you are building out a Sitecore MVC project or are just integrating Web API into your web forms project, you are going to want to expose the Sitecore Context to your controllers. An easy way to do this is to add a Route Pipeline in your httpRequestBegin section that will expose the Context. To do this, we will need to set up a patch config and a custom class that will actually expose the Sitecore Context.</p>

<h2 id="patch-config">Patch Config</h2>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;configuration</span> <span class="na">xmlns:patch=</span><span class="s">"http://www.sitecore.net/xmlconfig/"</span> <span class="na">xmlns:x=</span><span class="s">"http://www.sitecore.net/xmlconfig/"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;sitecore&gt;</span>
    <span class="nt">&lt;pipelines&gt;</span>
      <span class="nt">&lt;httpRequestBegin&gt;</span>
        <span class="nt">&lt;processor</span> <span class="na">x:before=</span><span class="s">"*[7]"</span> <span class="na">type=</span><span class="s">"Your.Framework.Pipelines.RoutePipeline, Your.Framework"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/httpRequestBegin&gt;</span>
    <span class="nt">&lt;/pipelines&gt;</span>
  <span class="nt">&lt;/sitecore&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre></figure>

<h2 id="yourframeworkpipelinesroutepipeline---custom-class">Your.Framework.Pipelines.RoutePipeline - Custom Class</h2>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web.Routing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Sitecore.Pipelines.HttpRequest</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Your.Framework.Pipelines</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">RoutePipeline</span> <span class="p">:</span> <span class="n">HttpRequestProcessor</span>
    <span class="p">{</span>
         <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Process</span><span class="p">(</span><span class="n">HttpRequestArgs</span> <span class="n">args</span><span class="p">)</span>
         <span class="p">{</span>
             <span class="n">RouteData</span> <span class="n">routeData</span> <span class="p">=</span> <span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="nf">GetRouteData</span><span class="p">(</span><span class="k">new</span> <span class="nf">HttpContextWrapper</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Context</span><span class="p">));</span>

             <span class="k">if</span> <span class="p">(</span><span class="n">routeData</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
             <span class="p">{</span>
                 <span class="n">HttpContext</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="nf">RemapHandler</span><span class="p">(</span><span class="n">routeData</span><span class="p">.</span><span class="n">RouteHandler</span><span class="p">.</span><span class="nf">GetHttpHandler</span><span class="p">(</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">RequestContext</span><span class="p">));</span>
                 <span class="n">args</span><span class="p">.</span><span class="nf">AbortPipeline</span><span class="p">();</span>
             <span class="p">}</span>
         <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Once you link these up the Sitecore Context will be exposed. You can confirm that the pipeline is being added to the config by going to <em>/sitecore/admin/showConfig.aspx</em>.</p>

		</p>	
		<p>
			<strong>Tags:</strong>
			MVC,Sitecore,C#
		</p>
		<a href="/posts">Back to Posts</a>
	</article>
	<div class="sidebar">
	<!-- <h4>Search</h4>
	<div class="posts-search">
		<input type="text" placeholder="Search Posts" />
		<button class="btn primary-btn">Submit</button>
		
		<a class="clear-results" href="/posts">Clear Results</a>
	</div> -->
	<h4>About the Author</h4>
	<div class="about--side">
		<p>I am a senior .NET engineer currently working at <a href="http://www.cardfree.com">CARDFREE</a> building out RESTful services to supports our mobile and web apps. My focus currently is around scalability, security, and ensuring our solutions are maintainable.</p>

<p>Originally from Boston, but have been living in Denver for several years now. In my spare time I try to keep pace with my energentic golden, hike and ski, and occassionally post something interesting.</p>
	</div>
</div>
</section>
      </section>
    </div>

    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24433484-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>